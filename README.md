# 좋아하면 누르는

<h1 align="center" style="max-width: 100%;">
  <img width="1100" alt="Logo" src="README.assets/title.png" style="max-width: 100%;" /><br/>
</h1>

<table>
  <tbody>
    <tr>
      <td><img width="500" src="README.assets/1.gif" alt="메인화면"></td>
      <td><img width="500" src="README.assets/2.gif" alt="하트송수신"></td?>
    </tr>
    <tr>
      <td><img width="500" src="README.assets/3.gif" alt="채팅"></td>
      <td><img width="500" src="README.assets/4.gif" alt="이모지변경"></td>
    </tr>
  </tbody>
</table>



<p align="center">
  <b>Supported</b><br/>
  <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/1200px-React-icon.svg.png" alt="react" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://w7.pngwing.com/pngs/727/307/png-transparent-java-development-kit-operating-systems-android-macos-android-text-logo-computer-program.png" alt="java" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://perfectacle.github.io/2017/08/02/Spring-boot-study-001day/thumb.png" alt="springboot" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://t1.daumcdn.net/cfile/tistory/991A86475C91BE1D40" alt="jpa" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://media.vlpt.us/images/ec532/post/bc893d61-4eaa-4f8f-9b2c-e2d2143506a4/aws_ec2.svg" alt="EC2" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Kubernetes_logo_without_workmark.svg/1200px-Kubernetes_logo_without_workmark.svg.png" alt="kube" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://perfectacle.github.io/2019/04/16/spring-boot-docker-image-optimization/thumb.png" alt="docker" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Jenkins_logo.svg/1200px-Jenkins_logo.svg.png" alt="jenkins" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://blog.kakaocdn.net/dn/rrEfB/btq97aMSAsX/lstil1pt0KJW0Iy2WPO0Mk/img.png" alt="nginx" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://w7.pngwing.com/pngs/747/798/png-transparent-mysql-logo-mysql-database-web-development-computer-software-dolphin-marine-mammal-animals-text.png" alt="mysql" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://w7.pngwing.com/pngs/63/19/png-transparent-mongodb-database-nosql-postgresql-mongo-text-logo-business-thumbnail.png" alt="mongo" />



## 💁 개요

### 다운로드 및 실행

웹 : www.someone-might-like-you.com

안드로이드 : https://play.google.com/store/apps/details?id=com.nianticlabs.pokemongo

아이폰 : https://play.google.com/store/apps/details?id=com.nianticlabs.pokemongo

<br>

<table style="table-layout: fixed; overflow-wrap: break-word;">
  <tbody>
    <tr>
      <td colspan="2"><a href="#" target="_blank"><img width="1000" src="README.assets/promotion.gif" alt="Parallax demo" style="max-width: 100%;" /></a></td>
    </tr>
  </tbody>
</table>



<h1 style="text-align:center" >
   익명 속에서 설렘을
</h1>
<h3 style="text-align:center">
  <br>
  주변 100m 이내의 사용자들은 서로의 위치를 공유합니다 <br><br>
  하트를 송수신 할 수 있으며, 하트가 매칭된 사용자들은 1:1 채팅이 자동으로 생성합니다 <br><br>
  이모지 변경, 유저 신고 등 부가적인 기능을 제공합니다
</h3>
<br>

## 💁 Release History

<h3 style="text-align:center;">
  22.05.21 - 앱스토어 출시</h3>  <h5  style="text-align:center;"><br></h5>

<h3 style="text-align:center;">
  22.05.20 - 플레이스토어 출시</h3>  <h5  style="text-align:center;"><br></h5>

<h3 style="text-align:center;">
  22.05.13 - Web 2차 배포</h3>  <h5  style="text-align:center;">안내 템플릿 <br> 건의함 <br> 위치 엑세스 허용 안내 <br> 이모지 변경 <br></h5>
<h3 style="text-align:center;">
  22.05.06 - Web 최초 배포</h3>
 <h5  style="text-align:center;"> 사용자간 위치 공유 <br> 하트 송수신 <br> 채팅 <br> 유저 신고 <br></h5>



## 🛠 아키텍처



![Lovepush_Architecture](README.assets/Lovepush_Architecture.jpg)



## 🛠 기술 스택

### 💎 **Front-end** 

| <img src="https://profilinator.rishav.dev/skills-assets/html5-original-wordmark.svg" alt="HTML5" width="50px" height="50px" /> | <img src="https://profilinator.rishav.dev/skills-assets/css3-original-wordmark.svg" alt="CSS3" width="50px" height="50px" /> | <img src="https://profilinator.rishav.dev/skills-assets/javascript-original.svg" alt="TypeScript" width="50px" height="50px" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                            HTML5                             |                             CSS3                             |                          javascript                          |

| <img src="https://profilinator.rishav.dev/skills-assets/react-original-wordmark.svg" alt="React.js" width="50px" height="50px" /> | Stomp | TypeScript |
| :----------------------------------------------------------: | :---: | :--------: |
|                            React                             | Stomp | TypeScript |

### 🚀 **Back-end**

| <img src="https://profilinator.rishav.dev/skills-assets/java-original-wordmark.svg" alt="Java" width="50px" height="50px" /> | <img src="https://www.seekpng.com/png/full/8-80775_spring-logo-png-transparent-spring-java.png" alt="Spring-Boot" width="50px" height="50px" /> | <img src="https://spring.io/images/projects/spring-data-79cc203ed8c54191215a60f9e5dc638f.svg" alt="JPA" width="50px" height="50px" /> | <img src="https://spring.io/images/projects/spring-security-b712a4cdb778e72eb28b8c55ec39dbd1.svg" alt="Spring-Security" width="50px" height="50px" /> | <img src="https://jwt.io/img/pic_logo.svg" alt="jwt" width="50px" height="50px" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                             Java                             |                         Spring-Boot                          |                          Spring-JPA                          |                       Spring-Security                        |                             JWT                              |



###  🚊 DB

| <img src="https://profilinator.rishav.dev/skills-assets/mysql-original-wordmark.svg" alt="MySQL" width="50px" height="50px" /> | <img src="https://raw.githubusercontent.com/devicons/devicon/1119b9f84c0290e0f0b38982099a2bd027a48bf1/icons/mongodb/mongodb-original-wordmark.svg" alt="MongoDB" width="50px" height="50px" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|                            MySQL                             |                           Mongodb                            |

### 🐬 **DevOps**

| <img src="https://profilinator.rishav.dev/skills-assets/nginx-original.svg" alt="NGiNX" width="50px" height="50px" /> | <img src="https://pbs.twimg.com/profile_images/1351702967561252865/aXfcETIt_400x400.jpg" alt="aws" width="50px" height="50px" /> | <img src="https://profilinator.rishav.dev/skills-assets/docker-original-wordmark.svg" alt="docker" width="50px" height="50px" /> | <img src="https://www.jenkins.io/images/logos/jenkins/jenkins.svg" alt="jenkins" width="50px" height="50px" /> | <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Kubernetes_logo_without_workmark.svg/926px-Kubernetes_logo_without_workmark.svg.png" alt="kubernetes" width="50px" height="50px" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                            NGiNX                             |                             aws                              |                            docker                            |                           Jenkins                            |                          Kubernetes                          |



### 💡 기획 및 운영

| <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Git-logo.svg/768px-Git-logo.svg.png?20160811101906" alt="Git" width="50px" height="50px" /> | <img src="https://wac-cdn-2.atlassian.com/image/upload/f_auto,q_auto/dam/jcr:b544631f-b225-441b-9e05-57b7fd0d495b/Jira%20Software@2x-icon-blue.png" alt="jira" width="50px" height="50px" /> | <img src="https://cdn2.downdetector.com/static/uploads/logo/figma2.png" alt="figma" width="50px" height="50px" /> | <img src="https://blog.kakaocdn.net/dn/2CufY/btq8RTsnYaT/3EQm1A8iL54UcCzFkemVJ1/img.png" alt="notion" width="50px" height="50px" /> | <img src="https://play-lh.googleusercontent.com/FERhw8K6nxOmNNthc4zLb6FnkO5_iDs-W4w3Uc_GiHosUYJlkeXHp-Qom5kbq4u__Ns" alt="mattermost" width="50px" height="50px" /> | <img src="https://play-lh.googleusercontent.com/0oO5sAneb9lJP6l8c6DH4aj6f85qNpplQVHmPmbbBxAukDnlO7DarDW0b-kEIHa8SQ=w512" alt="discord" width="50px" height="50px" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                             Git                              |                             JIRA                             |                            Figma                             |                            Notion                            |                          Mattermost                          |                           Discord                            |



### 📱 App

| <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Kotlin_Icon.svg/1200px-Kotlin_Icon.svg.png" alt="kotlin" width="50px" height="50px" /> | <img src="https://blog.kakaocdn.net/dn/bU8z6O/btqKXLx6c0Y/szaVg2oqCAUxMYex0n8zs1/img.png" alt="android_studio" width="50px" height="50px" /> | <img src="https://images.velog.io/images/gooreum_90/post/c53e169b-71ea-4bf5-84ce-9523949b2dfd/swiftlogo.png" alt="swift" width="50px" height="50px" /> | <img src="https://is5-ssl.mzstatic.com/image/thumb/Purple122/v4/9d/25/cf/9d25cfe3-2476-20ae-ed0f-8d67a188bad7/Xcode-85-220-0-4-2x.png/1200x630bb.png" alt="xcode" width="50px" height="50px" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|                            Kotlin                            |                        Android Studio                        |                            Swift                             |                            Xcode                             |



## 💞 팀 & 기술

<table>
<tr>
  <td valign="top" width="50%">
    <a href="https://github.com/eora21">
      <img src="README.assets/seunghoon.png" align="left" style="width: 98%" />
    </a>
  </td>
  <td valign="top" width="50%">
    <a href="https://avatars.githubusercontent.com/u/76445655?v=4">
      <img src="README.assets/geonhee.png" align="left" style="width: 98%" />
    </a>
  </td>
</tr>
<tr>
  <td valign="top" width="50%">
    <a href="https://github.com/82surf">
      <img src="README.assets/hyunsu.png" align="left" style="width: 98%" />
    </a>
  </td>
  <td valign="top" width="50%">
    <a href="https://github.com/Gkuer">
      <img src="README.assets/eune.png" align="left" style="width: 98%" />
    </a>
  </td>
  </tr>
  <tr>
    <td valign="top" width="50%">
    <a href="https://github.com/EuneeChung">
      <img src="README.assets/hyi.png" align="left" style="width: 98%" />
    </a>
  </td>
  <td valign="top" width="50%">
    <a href="https://github.com/gkstmdgns422">
      <img src="README.assets/juho.png" align="left" style="width: 98%" />
    </a>
  </td>
</tr>
</table>  


#### 🖥️ 주요 Stack

|                        Content                         |           Main            |                          Detail                          |
| :----------------------------------------------------: | :-----------------------: | :------------------------------------------------------: |
|              [**하트송수신**](#음성인식 )              | Python 3.9.6 / JavaScript |             webkitSpeechRecognition / Axios              |
|                  [**채팅**](#드로잉)                   |        JavaScript         |                Canvas / Blob Data/ Axios                 |
|                   [**위치 공유**]()                    |  HTML / CSS / JavaScript  |            Django 3.2.9 / HTML5 / CSS3 / ES6             |
|         [**Kubernetes**](#색채-데이터-만들기)          |  C# .Net Framework 4.7.2  |            C#(OpenCvSharp4 - V4.5.3.20210817)            |
| [**파이프라인 구축**](#알고리즘-구성-및-웹페이지-작업) |       Python 3.9.6        |                       Python(Math)                       |
|                    [**CI/CD**](#db)                    |       Python 3.9.6        |                    Python(Shell_plus)                    |
|           [**Ingress Nginx**](#query-최적화)           |       Django 3.2.9        |      prefetch_related / annotate / filter / exclude      |
|                   [**배포**](#배포)                    |            AWS            | EC2(Ubuntu Server 20.04 LTS) / Cloud9 / Gunicorn / NGINX |
| [**회원관리**](#--back-end) | JWT / Spring Security | JWT / HS512 / Spring Security |
| Android | Kotlin | Android Studio 4.1.1 / Web View |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
|                                                        |                           |                                                          |
||||


# ⚙️ Individual Tech Section



## 🏃 Section1, 김주호 - 위치 기반 기술과 채팅에 대하여

> BE: Springboot Websocket
>
> FE: sockjs-client@1.6.0 / @stomp/stompjs@6.1.2 / @types/sockjs-client@1.5.1 / @types/stompjs@2.3.5

#### 어떻게 근처 유저들을 얻어올 것인가?

제일 쉬운 방법은, 내 위치를 중심으로 모든 유저들과의 거리를 계산 후 100m 이내인 유저를 걸러내면 된다.

허나 이는 유저의 수가 많아지면 많아질수록 효율이 급감하며, 계속해서 유저들의 실시간 위치를 받아내야만 한다.

좋은 방법이 아닐 것 같아 많은 고민을 하던 중, [우아한 Tech 분산 이벤트 스트리밍](https://youtu.be/PvAlbOm9WN8?t=5516) 영상과 [카카오의 W3W](https://kakaomap.tistory.com/238)에서 영감을 얻어 전 세계를 정해진 크기의 구획으로 나눈 후 내 구획을 기준으로 주변의 구획 데이터를 얻어오면 될 것 같았다.

해당하는 방식이라면 주변 구획에 접근하여 유저 목록을 생성할 수 있으니, 굉장히 좋은 방법이라 생각했다.

아쉽게도 카카오의 W3W나 일반 [W3W](https://developer.what3words.com/public-api/docs)가 근처 구획만을 생성, 획득하는 방법으로는 방향성이 맞지 않다고 느껴졌기 때문에, **직접 gps 데이터를 계산하여 구획을 생성하는 방식**을 채택하였다.

#### gps data -> sector data?

보통 gps 데이터를 수신할 경우, 37.xxxxxxx, 127.xxxxxxx 의 값을 가져오게 된다.

해당하는 값을 하나의 구획으로 바꾸어야 한다. 구획은 몇 m로 세팅해야 하며, 손 쉽게 나눌 수 있는 방법은 무엇이 있을까?

우선 1m가 gps상에서 몇 차이가 나는지 확인해 보았다. [해당 글을 참고](https://m.cafe.daum.net/gpsyn/Pllz/530)하자면, 0.00001도 차이가 대략 1m라 한다. 정확하게는 물론 아니겠지만, 해당 방법으로 전 세계 구획을 나눈 후 작업해도 괜찮을 것 같다는 생각을 했다. 그러나 더욱 정확한 계측을 위해, [두 지역 사이의 거리를 측정해 주는 사이트](http://www.movable-type.co.uk/scripts/latlong.html)를 찾아갔다.

![img](README.assets/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fed37fafd-1e8b-4da1-9a86-e5025e64e01b%2FUntitled.png)

해당 사이트의 계산에 의하면, `3m`는 도분초 좌표계 기준으로 `0.0973초`만큼 차이가 있었다.

![img](README.assets/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F364cd5ca-4fe0-4d76-b841-13e267fde059%2FUntitled.png)

`0.1초` 차이는 `3.083m`만큼 차이가 났으며, `1초` 차이는 `30.83m`차이였다.

그렇다면, gps 데이터를 수신한 후 도분초 좌표계로 변환하고, 소수점을 제외한 데이터를 구획으로 삼으면 되지 않을까 하는 생각이 들어 바로 착수했다. 정확히 100m는 어렵겠지만, 대략적인 100m 데이터를 얻을 수 있으므로..

#### Sector 구현

지구의 모든 구역을 30m * 30m 2차원 배열로 만들기에는 메모리 낭비가 너무 크다. index도 계산해줘야 하는 이슈가 있으므로 HashMap을 만든 후 gps 구획 데이터를 key로 들고 있기로 했다.

비로그인 사용자도 이용할 수 있어야 하므로 소켓 세션 id를 해당 구획 value의 key로 잡고, pk와 이모지URL을 value로 지니고 있게끔 했다.

```json
{
	"36/21/101/127/20/583":{
	"5ubuuxi3":{
		"pk":1,"emojiURL":"emoji"
		}
	}
}
```

또한 유저가 이동해 구획이 변경되거나 로그인 등으로 이모지가 변경된다면 basic 채널에 메세지를 전송하여 모든 유저가 알 수 있게끔 메세지를 보내도록 했다. 이는 스케쥴러를 사용하였다.

```java
@Scheduled(fixedRate = 5000)
public void sendBasicChat() {  // basic으로 전체 채팅 보내기
    if (gpsRepository.getOperationCommand()) {
        messageTemplate.convertAndSend("/sub/basic", gpsRepository.getAllGpsSectorData());
        gpsRepository.setOffOperationCommand();
    }
}
```



소켓통신이 끊긴다면 해당하는 구획에서 데이터를 삭제해야 하므로, 소켓 연결 및 구획 변경 시마다 각각의 세션에 현재 구획을 들고 있다가, 끊길 경우 구획으로 접근해 해당하는 세션id값을 제거하도록 했다.

```java
@EventListener
public void handleSessionConnect(SessionConnectEvent event) {
    SimpAttributesContextHolder.currentAttributes().setAttribute("GPS", "");
}

@EventListener
public void handleSessionDisconnect(SessionDisconnectEvent event) {
    String gpsKey = (String) SimpAttributesContextHolder.currentAttributes().getAttribute("GPS");
    String sessionId = event.getSessionId();
    gpsRepository.dropUser(gpsKey, sessionId);
}
```



## 🏃 Section2, 남궁휘 - 



## 🏃 Section3, 유현수 -


## 🏃 Section4, 이건희 - 쿠버네티스, 도커, 젠킨스를 활용한 배포와 CI/CD에 대하여



## 🏃 Section5, 정은이 - 위치 기반 기술과 채팅에 대하여



## 🏃 Section6, 한승훈 - 위치 기반 기술과 채팅에 대하여






## 📖 Reference

formdata - https://developer.mozilla.org/ko/docs/Web/API/FormData

그림판 - https://github.com/shlee0882/painting-js

